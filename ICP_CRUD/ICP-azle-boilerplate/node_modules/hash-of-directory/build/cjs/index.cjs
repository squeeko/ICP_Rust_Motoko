"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.hashOfDirectory = void 0;
const crypto_1 = require("crypto");
const promises_1 = require("fs/promises");
const calculate = async (dir, hash) => {
    const files = (await (0, promises_1.readdir)(dir, { withFileTypes: true })).sort();
    for (const file of files) {
        if (file.isDirectory()) {
            hash.update(file.name);
            await calculate(`${dir}/${file.name}`, hash);
        }
        else {
            const content = await (0, promises_1.readFile)(`${dir}/${file.name}`);
            hash.update(file.name);
            hash.update(content);
        }
    }
};
const hashOfDirectory = async (dir, opts = {}) => {
    const { algorithm = "sha256", encoding = "base64" } = opts;
    const hash = (0, crypto_1.createHash)(algorithm);
    await calculate(dir, hash);
    return hash.digest(encoding);
};
exports.hashOfDirectory = hashOfDirectory;
